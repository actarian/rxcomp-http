{"version":3,"sources":["www/browser/src/main.browser.ts","../../src/http/http-event.ts","../../src/http/http-headers.ts","../../src/http/http-error-response.ts","../../src/http/http-response.ts","../../src/http/http-fetch.handler.ts","../../src/http/http-interceptor.ts","../../src/http.module.ts","../../src/http/http-params.ts","../../src/http/http-request.ts","../../src/http/http.service.ts","../../www/browser/src/app.component.ts","../../www/browser/src/http/custom.interceptor.ts","../../www/browser/src/app.module.ts","../../www/browser/src/main.browser.ts"],"names":["rxcomp","rxjs","operators","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","_setPrototypeOf","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","push","apply","instance","Function","bind","arguments","_wrapNativeSuper","_cache","Map","undefined","fn","indexOf","TypeError","has","get","set","Wrapper","this","value","HttpEventType","HttpHeaders","options","_this","headers_","headers","forEach","split","keys","values","append","line","index","slice","trim","_proto","join","clone","clone_","delete","callback","thisArg","_this2","v","k","serialize","toObject","HttpErrorResponse","_Error","message","status","statusText","ok","type","ResponseError","name","url","error","request","assign","Error","HttpResponse","Response","body","_proto2","response","HttpFetchHandler","response_","handle","method","requestInfo","urlWithParams","requestInit","toInitRequest","stateKey","TransferService","makeKey","transferKey","isPlatformBrowser","hydrate","transfer","remove","of","from","fetch","then","getProgress","getResponse","pipe","tap","isPlatformServer","catchError","errorResponse","httpErrorResponse","nextError$","next","finalize","clonedBody","reportProgress","reader","getReader","contentLength","Promise","resolve","reject","progress","percent","current","total","read","_ref2","onProgress","done","receivedLength","closed","_ref","responseType","json","catch","err","console","log","getResponseType","_this3","getReadableStream","ReadableStream","start","controller","_ref3","close","enqueue","HttpInterceptorHandler","interceptor","req","intercept","HttpInterceptors","fetchHandler","HttpInterceptingHandler","chain","interceptors","reduceRight","factories","pipes","HttpModule","_Module","useInterceptors","interceptorFactories","map","x","Module","declarations","concat","exports","HttpUrlEncodingCodec","encodeKey","encodeParam_","encodeValue","decodeKey","decodeURIComponent","decodeValue","HttpParams","encoder","params_","params","Array","isArray","queryString","keyValue","parseRawParams_","getAll","filter","encodeURIComponent","replace","HttpRequest","third","fourth","withCredentials","observe","isStaticFile","test","toUpperCase","methodHasBody_","sep","Constructor","protoProps","staticProps","serializeBody","isArrayBuffer_","isBlob_","isFormData_","JSON","stringify","detectContentTypeHeader","mode","credentials","cache","redirect","toFetchRequest__","Request","pathname","getLocationComponents","paramsKey","optionsToKey","bodyKey","ArrayBuffer","Blob","FormData","HttpService","incrementPendingRequest","pendingRequests$","getValue","decrementPendingRequest","request$","first","events$","concatMap","handler","throwError","getError","event","delete$","get$","head$","jsonp$","callbackParam","options$","patch$","optionsWithBody_","post$","put$","statusCode","statusMessage","BehaviorSubject","AppComponent","_Component","items","onInit","getContext","node","classList","add","subscribe","data","getTodos","pushChanges","errors$","takeUntil","unsubscribe$","onClick","item","completed","Component","selector","CustomRequestInterceptor","CustomResponseInterceptor","AppModule","imports","CoreModule","bootstrap","Browser"],"mappings":"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","file":"docs/js/main.min.js","sourcesContent":[null,"export enum HttpEventType {\n\tSent,\n\tUploadProgress,\n\tResponseHeader,\n\tDownloadProgress,\n\tResponse,\n\tUser,\n\tResponseError,\n}\n\nexport interface HttpProgressEvent {\n\ttype: HttpEventType.DownloadProgress | HttpEventType.UploadProgress;\n\tloaded: number;\n\ttotal?: number;\n}\n\nexport interface HttpDownloadProgressEvent extends HttpProgressEvent {\n\ttype: HttpEventType.DownloadProgress;\n\tpartialText?: string;\n}\n\nexport interface HttpUploadProgressEvent extends HttpProgressEvent {\n\ttype: HttpEventType.UploadProgress;\n}\n\nexport interface HttpSentEvent {\n\ttype: HttpEventType.Sent;\n}\n\nexport interface HttpUserEvent<T> {\n\ttype: HttpEventType.User;\n}\n","\nexport type IHttpHeaders = string | { [name: string]: string | string[] };\n\nexport class HttpHeaders implements Headers {\n\tprivate headers_: Map<string, string[]> = new Map<string, string[]>();\n\n\tconstructor(options?: HttpHeaders | Headers | { [key: string]: string | string[] } | string | undefined) {\n\t\tconst headers = this.headers_;\n\t\tif (options instanceof HttpHeaders) {\n\t\t\toptions.headers_.forEach((value, key) => {\n\t\t\t\theaders.set(key, value);\n\t\t\t});\n\t\t} else if (typeof (options as Headers)?.forEach === 'function') {\n\t\t\t(options as Headers).forEach((value, key) => {\n\t\t\t\theaders.set(key, value.split(', '));\n\t\t\t});\n\t\t} else if (typeof options === 'object') {\n\t\t\tObject.keys(options).forEach(key => {\n\t\t\t\tlet values: string | string[] = (options as any)[key];\n\t\t\t\tif (typeof values === 'string') {\n\t\t\t\t\tvalues = [values];\n\t\t\t\t}\n\t\t\t\tif (headers.has(key)) {\n\t\t\t\t\tvalues.forEach(value => this.append(key, value));\n\t\t\t\t} else {\n\t\t\t\t\theaders.set(key, values);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (typeof options === 'string') {\n\t\t\toptions.split('\\n').forEach(line => {\n\t\t\t\tconst index = line.indexOf(':');\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tconst key = line.slice(0, index);;\n\t\t\t\t\tconst value = line.slice(index + 1).trim();\n\t\t\t\t\tif (headers.has(key)) {\n\t\t\t\t\t\tthis.append(key, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\theaders.set(key, [value]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!headers.has('Accept')) {\n\t\t\theaders.set('Accept', ['application/json', 'text/plain', '*/*']);\n\t\t}\n\t\tif (!headers.has('Content-Type')) {\n\t\t\theaders.set('Content-Type', ['application/json']);\n\t\t}\n\t}\n\n\thas(key: string): boolean {\n\t\treturn this.headers_.has(key);\n\t}\n\n\tget(key: string): string | null {\n\t\tconst values = this.headers_.get(key);\n\t\treturn values ? values.join(', ') : null;\n\t}\n\n\tset(key: string, value: string): HttpHeaders {\n\t\tconst clone = this.clone_();\n\t\tclone.headers_.set(key, value.split(', '));\n\t\treturn clone;\n\t}\n\n\tappend(key: string, value: string): HttpHeaders {\n\t\tconst clone = this.clone_();\n\t\tconst values: string[] = clone.headers_.has(key) ? clone.headers_.get(key) || [] : [];\n\t\tvalues.push(value);\n\t\tclone.headers_.set(key, values);\n\t\treturn clone;\n\t}\n\n\tdelete(key: string): HttpHeaders {\n\t\tconst clone = this.clone_();\n\t\tclone.headers_.delete(key);\n\t\treturn clone;\n\t}\n\n\tforEach(callback: (value: string, key: string, parent: Headers) => void, thisArg?: any): void {\n\t\tthis.headers_.forEach((v, k) => {\n\t\t\tcallback(v.join(', '), k, this);\n\t\t});\n\t}\n\n\tserialize(): Headers | string[][] | Record<string, string> | undefined {\n\t\tconst headers: string[][] = [];\n\t\tthis.forEach((value, key) => {\n\t\t\theaders.push([key, value]);\n\t\t});\n\t\treturn headers;\n\t}\n\n\ttoObject(): { [key: string]: string } {\n\t\tconst headers: { [key: string]: string } = {};\n\t\tthis.forEach((value, key) => {\n\t\t\theaders[key] = value;\n\t\t});\n\t\treturn headers;\n\t}\n\n\tprivate clone_(): HttpHeaders {\n\t\tconst clone = new HttpHeaders();\n\t\tthis.headers_.forEach((value, key) => {\n\t\t\tclone.headers_.set(key, value);\n\t\t});\n\t\treturn clone;\n\t}\n\n}\n","import { HttpEventType } from './http-event';\nimport { HttpHeaders } from './http-headers';\nimport { HttpRequest } from './http-request';\nimport { IHttpHeaderResponse } from './http-response';\n\nexport interface IHttpJsonParseError {\n\terror: Error;\n\ttext: string;\n}\n\nexport interface IHttpErrorResponse<T> extends IHttpHeaderResponse<T> {\n\terror?: any | undefined;\n\tmessage?: string;\n\tname?: string;\n\trequest?: HttpRequest<T> | null;\n}\n\nexport class HttpErrorResponse<T> extends Error implements IHttpErrorResponse<T> {\n\treadonly headers!: HttpHeaders;\n\treadonly status: number = 0;\n\treadonly statusText: string = 'Unknown Error';\n\treadonly url: string | undefined;\n\treadonly ok: boolean = false;\n\treadonly type: HttpEventType.ResponseError = HttpEventType.ResponseError;\n\treadonly error: any | undefined;\n\treadonly message: string = 'Unknown Error';\n\treadonly name: string = 'HttpErrorResponse';\n\treadonly request!: HttpRequest<T> | null;\n\tconstructor(options?: IHttpErrorResponse<T>) {\n\t\tsuper(options?.message || 'Unknown Error');\n\t\tif (options) {\n\t\t\tthis.headers = new HttpHeaders(options.headers);\n\t\t\tthis.status = options.status || this.status;\n\t\t\tthis.statusText = options.statusText || this.statusText;\n\t\t\tthis.url = options.url || this.url;\n\t\t\tthis.error = options.error || this.error;\n\t\t\tthis.name = options.name || this.name;\n\t\t\tthis.request = options.request || null;\n\t\t}\n\t}\n\tclone<T>(options?: IHttpErrorResponse<T>): HttpErrorResponse<T> {\n\t\toptions = Object.assign({\n\t\t\theaders: this.headers,\n\t\t\tstatus: this.status,\n\t\t\tstatusText: this.statusText,\n\t\t\turl: this.url,\n\t\t\terror: this.error,\n\t\t\tmessage: this.message,\n\t\t\tname: this.name,\n\t\t\trequest: this.request,\n\t\t}, options || {});\n\t\tconst clone = new HttpErrorResponse<T>(options);\n\t\treturn clone;\n\t}\n}\n","import { HttpEventType, HttpProgressEvent, HttpSentEvent, HttpUserEvent } from './http-event';\nimport { HttpHeaders } from './http-headers';\nimport { HttpBodyType } from './http-request';\n\nexport type HttpEvent<T> = HttpSentEvent | HttpHeaderResponse<T> | HttpResponse<T> | HttpProgressEvent | HttpUserEvent<T>;\n\nexport interface IHttpHeaderResponse<T> {\n\theaders?: HttpHeaders,\n\tstatus?: number,\n\tstatusText?: string,\n\turl?: string,\n\tok?: boolean;\n\ttype?: HttpEventType;\n}\n\nexport interface IHttpResponse<T> extends IHttpHeaderResponse<T> {\n\tbody?: HttpBodyType<T>;\n}\n\nexport class HttpHeaderResponse<T> implements IHttpHeaderResponse<T> {\n\treadonly headers!: HttpHeaders;\n\treadonly status: number = 200;\n\treadonly statusText: string = 'OK';\n\treadonly url: string | undefined;\n\treadonly ok: boolean;\n\treadonly type: HttpEventType.ResponseHeader = HttpEventType.ResponseHeader;\n\tconstructor(options?: IHttpHeaderResponse<T>) {\n\t\tif (options) {\n\t\t\tthis.headers = new HttpHeaders(options.headers);\n\t\t\tthis.status = options.status || this.status;\n\t\t\tthis.statusText = options.statusText || this.statusText;\n\t\t\tthis.url = options.url || this.url;\n\t\t}\n\t\tthis.ok = this.status >= 200 && this.status < 300;\n\t}\n\tclone<T>(options?: IHttpHeaderResponse<T>): HttpHeaderResponse<T> {\n\t\toptions = Object.assign({\n\t\t\theaders: this.headers,\n\t\t\tstatus: this.status,\n\t\t\tstatusText: this.statusText,\n\t\t\turl: this.url,\n\t\t\tok: this.ok,\n\t\t\ttype: this.type,\n\t\t}, options || {});\n\t\tconst clone = new HttpHeaderResponse<T>(options);\n\t\treturn clone;\n\t}\n}\n\nexport class HttpResponse<T> implements IHttpResponse<T> {\n\treadonly headers!: HttpHeaders;\n\treadonly status: number = 200;\n\treadonly statusText: string = 'OK';\n\treadonly url: string | undefined;\n\treadonly ok: boolean;\n\treadonly type: HttpEventType.Response = HttpEventType.Response;\n\treadonly body: HttpBodyType<T> = null;\n\tconstructor(options?: IHttpResponse<T>) {\n\t\tif (options) {\n\t\t\tthis.headers = new HttpHeaders(options.headers);\n\t\t\tthis.status = options.status || this.status;\n\t\t\tthis.statusText = options.statusText || this.statusText;\n\t\t\tthis.url = options.url || this.url;\n\t\t\tthis.body = options.body || this.body;\n\t\t}\n\t\tthis.ok = this.status >= 200 && this.status < 300;\n\t}\n\tclone<T>(options?: IHttpResponse<T>): HttpResponse<T> {\n\t\toptions = Object.assign({\n\t\t\theaders: this.headers,\n\t\t\tstatus: this.status,\n\t\t\tstatusText: this.statusText,\n\t\t\turl: this.url,\n\t\t\tok: this.ok,\n\t\t\ttype: this.type,\n\t\t\tbody: this.body,\n\t\t}, options || {});\n\t\tconst clone = new HttpResponse<T>(options);\n\t\treturn clone;\n\t}\n\ttoObject(): { [key: string]: any } {\n\t\tconst response: { [key: string]: any } = {};\n\t\tresponse.url = this.url;\n\t\tresponse.headers = this.headers.toObject();\n\t\tresponse.status = this.status;\n\t\tresponse.statusText = this.statusText;\n\t\tresponse.ok = this.ok;\n\t\tresponse.type = this.type;\n\t\tresponse.body = this.body;\n\t\treturn response;\n\t}\n}\n\nexport abstract class HttpResponseBase<T> {\n\treadonly headers: HttpHeaders;\n\treadonly status: number = 200;\n\treadonly statusText: string = 'OK';\n\treadonly url: string | undefined;\n\treadonly ok: boolean;\n\treadonly type!: HttpEventType.Response | HttpEventType.ResponseHeader;\n\tconstructor(\n\t\toptions: IHttpHeaderResponse<T>,\n\t\tdefaultStatus: number = 200,\n\t\tdefaultStatusText: string = 'OK'\n\t) {\n\t\tthis.headers = options.headers || new HttpHeaders();\n\t\tthis.status = options.status !== undefined ? options.status : defaultStatus;\n\t\tthis.statusText = options.statusText || defaultStatusText;\n\t\tthis.url = options.url || undefined;\n\t\tthis.ok = this.status >= 200 && this.status < 300;\n\t}\n}\n\n/*\n// !!!\nexport default class HttpResponse {\n\tdata?: any;\n\turl: string = '';\n\tstatus: number = 0;\n\tstatusText: string = '';\n\tok: boolean = false;\n\tredirected: boolean = false;\n\tget static() {\n\t\treturn this.url!.indexOf('.json') === this.url!.length - 5;\n\t}\n\tconstructor(response: Response) {\n\t\tthis.data = null;\n\t\tif (response) {\n\t\t\tthis.url = response.url;\n\t\t\tthis.status = response.status;\n\t\t\tthis.statusText = response.statusText;\n\t\t\tthis.ok = response.ok;\n\t\t\tthis.redirected = response.redirected;\n\t\t}\n\t}\n}\n*/\n","import { isPlatformBrowser, isPlatformServer, nextError$, TransferService } from 'rxcomp';\nimport { from, Observable, of } from 'rxjs';\nimport { catchError, finalize, tap } from 'rxjs/operators';\nimport { HttpErrorResponse, IHttpErrorResponse } from './http-error-response';\nimport { HttpHandler } from './http-handler';\nimport { HttpRequest } from './http-request';\nimport { HttpEvent, HttpResponse, IHttpResponse } from './http-response';\n\nexport class HttpFetchHandler implements HttpHandler {\n\n\tprivate response_: HttpResponse<any> | null = null;\n\n\thandle<T>(request: HttpRequest<any>): Observable<HttpEvent<T>> {\n\t\tif (!request.method) {\n\t\t\tthrow new Error(`missing method`);\n\t\t}\n\t\tconst requestInfo: RequestInfo = request.urlWithParams;\n\t\tconst requestInit: RequestInit = request.toInitRequest();\n\t\t// console.log('fetchRequest', fetchRequest);\n\t\t// fetchRequest.headers.forEach((value, key) => console.log('HttpFetchHandler.handle', key, value));\n\t\t// request = request.clone({ headers: fetchRequest.headers });\n\t\t// console.log('HttpFetchHandler.handle', 'requestInfo', requestInfo, 'requestInit', requestInit);\n\t\t// hydrate\n\t\tconst stateKey = TransferService.makeKey(request.transferKey);\n\t\t// console.log('HttpFetchHandler.get', 'stateKey', stateKey, 'isPlatformBrowser', isPlatformBrowser, 'hydrate', request.hydrate);\n\t\tlet response: HttpResponse<T> | undefined;\n\t\tif (isPlatformBrowser && request.hydrate && TransferService.has(stateKey)) {\n\t\t\tlet transfer: IHttpResponse<T> | undefined = TransferService.get<IHttpResponse<T>>(stateKey);\n\t\t\tif (transfer) {\n\t\t\t\tresponse = new HttpResponse<T>(transfer);\n\t\t\t}\n\t\t\t// console.log('HttpFetchHandler', cached);\n\t\t\tTransferService.remove(stateKey);\n\t\t}\n\t\t// hydrate\n\t\tif (response) {\n\t\t\treturn of(response);\n\t\t} else {\n\t\t\treturn from(\n\t\t\t\tfetch(requestInfo, requestInit)\n\t\t\t\t\t// fetch(fetchRequest)\n\t\t\t\t\t.then((response: Response) => this.getProgress<T>(response, request))\n\t\t\t\t\t.then((response: Response | HttpResponse<T>) => this.getResponse<T>(response, request))\n\t\t\t).pipe(\n\t\t\t\t// hydrate\n\t\t\t\ttap(response => {\n\t\t\t\t\t// console.log('HttpFetchHandler.set', 'isPlatformServer', isPlatformServer, 'hydrate', request.hydrate, response);\n\t\t\t\t\tif (isPlatformServer && request.hydrate) {\n\t\t\t\t\t\tTransferService.set(stateKey, response.toObject());\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\t// hydrate\n\t\t\t\tcatchError((error: Error) => {\n\t\t\t\t\tconst errorResponse: IHttpErrorResponse<T> = { error };\n\t\t\t\t\tif (this.response_) {\n\t\t\t\t\t\terrorResponse.headers = this.response_.headers;\n\t\t\t\t\t\terrorResponse.status = this.response_.status;\n\t\t\t\t\t\terrorResponse.statusText = this.response_.statusText;\n\t\t\t\t\t\terrorResponse.url = this.response_.url;\n\t\t\t\t\t\terrorResponse.request = request;\n\t\t\t\t\t}\n\t\t\t\t\tconst httpErrorResponse = new HttpErrorResponse<T>(errorResponse);\n\t\t\t\t\t// console.log('httpErrorResponse', httpErrorResponse);\n\t\t\t\t\tnextError$.next(httpErrorResponse);\n\t\t\t\t\treturn of(this.response_) as Observable<any>;\n\t\t\t\t\t// return throwError(httpErrorResponse);\n\t\t\t\t}),\n\t\t\t\tfinalize(() => {\n\t\t\t\t\tthis.response_ = null;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}\n\n\tgetProgress<T>(response: Response, request: HttpRequest<any>): Promise<Response | HttpResponse<T>> {\n\t\t// console.log('HttpFetchHandler.setProgress', request.reportProgress, response.body);\n\t\tconst clonedBody = response.clone().body;\n\t\tif (isPlatformBrowser && request.reportProgress && clonedBody) {\n\t\t\tconst reader: ReadableStreamDefaultReader<Uint8Array> = clonedBody.getReader();\n\t\t\tconst contentLength = response.headers && response.headers.has('Content-Length') ? +(response.headers.get('Content-Length') || 0) : 0;\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t/*\n\t\t\t\tlet receivedLength = 0; // received that many bytes at the moment\n\t\t\t\tconst chunks: Uint8Array[] = []; // array of received binary chunks (comprises the body)\n\t\t\t\tconst getChunk = () => {\n\t\t\t\t\treturn reader.read().then(({ done, value }) => {\n\t\t\t\t\t\tif (!done) {\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tchunks.push(value);\n\t\t\t\t\t\t\t\treceivedLength += value.length || 0;\n\t\t\t\t\t\t\t\tconsole.log(`HttpFetchHandler.setProgress ${(receivedLength / contentLength * 100).toFixed(2)}% ${receivedLength} of ${contentLength}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tgetChunk();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treader.cancel();\n\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t\tif (false) {\n\t\t\t\t\t\t\t\t// Step 4: concatenate chunks into single Uint8Array\n\t\t\t\t\t\t\t\tconst chunksAll = new Uint8Array(receivedLength); // (4.1)\n\t\t\t\t\t\t\t\tlet position = 0;\n\t\t\t\t\t\t\t\tfor (let chunk of chunks) {\n\t\t\t\t\t\t\t\t\tchunksAll.set(chunk, position); // (4.2)\n\t\t\t\t\t\t\t\t\tposition += chunk.length;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Step 5: decode into a string\n\t\t\t\t\t\t\t\tconst result = new TextDecoder(\"utf-8\").decode(chunksAll);\n\t\t\t\t\t\t\t\t// We're done!\n\t\t\t\t\t\t\t\tconst data = JSON.parse(result);\n\t\t\t\t\t\t\t\tconsole.log('HttpFetchHandler.setProgress data', data);\n\t\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\treader.cancel();\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tgetChunk();\n\t\t\t\t*/\n\t\t\t\tconst progress = { progress: 0, percent: 0, current: 0, total: 0 };\n\t\t\t\tconst onProgress = (value: Uint8Array | undefined, done: boolean): Promise<any> => {\n\t\t\t\t\tlet receivedLength = progress.current;\n\t\t\t\t\tif (!done) {\n\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\treceivedLength += value.length || 0;\n\t\t\t\t\t\t\tprogress.total = contentLength;\n\t\t\t\t\t\t\tprogress.current = receivedLength;\n\t\t\t\t\t\t\tprogress.progress = receivedLength / contentLength;\n\t\t\t\t\t\t\tprogress.percent = progress.progress * 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// console.log('progress', progress);\n\t\t\t\t\t\treturn reader.read().then(({ value, done }) => onProgress(value, done));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprogress.total = contentLength;\n\t\t\t\t\t\tprogress.current = contentLength;\n\t\t\t\t\t\tprogress.progress = 1;\n\t\t\t\t\t\tprogress.percent = 100;\n\t\t\t\t\t\t// console.log('progress', progress);\n\t\t\t\t\t\treturn reader.closed.then(() => response.clone());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treader.read()\n\t\t\t\t\t.then(({ value, done }) => onProgress(value, done))\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tthis.response_ = new HttpResponse<T>(response as unknown as IHttpResponse<T>);\n\t\t\t\t\t\tif (typeof (response as any)[request.responseType] === 'function') {\n\t\t\t\t\t\t\treturn (response as any)[request.responseType]().then((json: any) => {\n\t\t\t\t\t\t\t\tthis.response_ = new HttpResponse<T>(Object.assign(this.response_, { body: json }) as IHttpResponse<T>);\n\t\t\t\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\t\t\t\treturn resolve(this.response_);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn reject(this.response_);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn reject(this.response_);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => console.log(\"upload error:\", err));\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve(response);\n\t\t}\n\t}\n\n\tgetResponse<T>(response: Response | HttpResponse<T>, request: HttpRequest<any>): Promise<HttpResponse<T>> {\n\t\tthis.response_ = new HttpResponse<T>(response as IHttpResponse<T>);\n\t\tif (isPlatformBrowser && request.reportProgress && response.body) {\n\t\t\treturn Promise.resolve(this.response_);\n\t\t} else {\n\t\t\treturn this.getResponseType(response as Response, request);\n\t\t}\n\t}\n\n\tgetResponseType<T>(response: Response, request: HttpRequest<any>): Promise<HttpResponse<T>> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.response_ = new HttpResponse<T>(response as unknown as IHttpResponse<T>);\n\t\t\tif (typeof (response as any)[request.responseType] === 'function') {\n\t\t\t\treturn (response as any)[request.responseType]().then((json: any) => {\n\t\t\t\t\tthis.response_ = new HttpResponse<T>(Object.assign(this.response_, { body: json }) as IHttpResponse<T>);\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\treturn resolve(this.response_);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn reject(this.response_);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn reject(this.response_);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetReadableStream<T>(response: Response, request: HttpRequest<any>): ReadableStream {\n\t\tconst reader = response.body!.getReader();\n\t\tconst readableStream = new ReadableStream({\n\t\t\tstart(controller) {\n\t\t\t\t// console.log(\"starting upload, request.bodyUsed:\", request.bodyUsed);\n\t\t\t\t// controller.enqueue(request.bodyUsed);\n\t\t\t\t// The following function handles each data chunk\n\t\t\t\tconst push = function () {\n\t\t\t\t\t// \"done\" is a Boolean and value a \"Uint8Array\"\n\t\t\t\t\treader.read().then(({ done, value }) => {\n\t\t\t\t\t\t// Is there no more data to read?\n\t\t\t\t\t\tif (done) {\n\t\t\t\t\t\t\t// Tell the browser that we have finished sending data\n\t\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Get the data and send it to the browser via the controller\n\t\t\t\t\t\tcontroller.enqueue(value);\n\t\t\t\t\t\tpush();\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tpush();\n\t\t\t},\n\t\t\t/*\n\t\t\tpull(controller) {\n\t\t\t\tif (request.bodyUsed) {\n\t\t\t\t\tcontroller.close();\n\t\t\t\t}\n\t\t\t\tcontroller.enqueue(request.bodyUsed);\n\t\t\t\tconsole.log(\"pull, request.bodyUsed:\", request.bodyUsed);\n\t\t\t},\n\t\t\tcancel(reason) {\n\t\t\t\tconsole.log(reason);\n\t\t\t}\n\t\t\t*/\n\t\t});\n\t\treturn readableStream;\n\t}\n\n\t/*\n\tonProgress(value: Uint8Array, done: boolean, request, reader, progress) {\n\t\tconsole.log(\"value:\", value);\n\t\tif (value || done) {\n\t\t\tconsole.log(\"upload complete, request.bodyUsed:\", request.bodyUsed);\n\t\t\tprogress.value = progress.max;\n\t\t\treturn reader.closed.then(() => fileUpload);\n\t\t};\n\t\tconsole.log(\"upload progress:\", value);\n\t\tif (progress.value < file.size) {\n\t\t\tprogress.value += 1;\n\t\t}\n\t\treturn reader.read().then(({ value, done }) => this.onProgress(value, done, request, reader, progress));\n\t}\n\t*/\n\n\t/*\n\tgetProgress_(request) {\n\t\tconst uploadProgress = new ReadableStream({\n\t\t\tstart(controller) {\n\t\t\t\tconsole.log(\"starting upload, request.bodyUsed:\", request.bodyUsed);\n\t\t\t\tcontroller.enqueue(request.bodyUsed);\n\t\t\t},\n\t\t\tpull(controller) {\n\t\t\t\tif (request.bodyUsed) {\n\t\t\t\t\tcontroller.close();\n\t\t\t\t}\n\t\t\t\tcontroller.enqueue(request.bodyUsed);\n\t\t\t\tconsole.log(\"pull, request.bodyUsed:\", request.bodyUsed);\n\t\t\t},\n\t\t\tcancel(reason) {\n\t\t\t\tconsole.log(reason);\n\t\t\t}\n\t\t});\n\t\tconst [fileUpload, reader] = [\n\t\t\tupload(request).catch(e => {\n\t\t\t\treader.cancel();\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow e\n\t\t\t}), uploadProgress.getReader()\n\t\t];\n\t}\n\t*/\n\n}\n","import { Observable } from 'rxjs';\nimport { HttpFetchHandler } from './http-fetch.handler';\nimport { HttpHandler } from './http-handler';\nimport { HttpRequest } from './http-request';\nimport { HttpEvent } from './http-response';\nimport { HttpXhrHandler } from './http-xhr.handler';\n\nexport interface IHttpInterceptorConstructor {\n\tnew(): IHttpInterceptor;\n}\nexport interface IHttpInterceptor {\n\tintercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>;\n}\nexport class HttpInterceptorHandler implements HttpHandler {\n\tconstructor(private next: HttpHandler, private interceptor: IHttpInterceptor) { }\n\thandle(req: HttpRequest<any>): Observable<HttpEvent<any>> {\n\t\treturn this.interceptor.intercept(req, this.next);\n\t}\n}\nexport const HttpInterceptors: IHttpInterceptor[] = [];\nexport class NoopInterceptor implements IHttpInterceptor {\n\tintercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n\t\treturn next.handle(req);\n\t}\n}\nexport const fetchHandler: HttpHandler = new HttpFetchHandler();\nexport const xhrHandler: HttpHandler = new HttpXhrHandler();\nexport class HttpInterceptingHandler implements HttpHandler {\n\tprivate chain: HttpHandler | null = null;\n\thandle(req: HttpRequest<any>): Observable<HttpEvent<any>> {\n\t\tif (this.chain === null) {\n\t\t\tconst interceptors = HttpInterceptors;\n\t\t\tthis.chain = interceptors.reduceRight((next, interceptor) => new HttpInterceptorHandler(next, interceptor), fetchHandler);\n\t\t}\n\t\treturn this.chain.handle(req);\n\t}\n}\nexport function interceptingHandler(handler: HttpHandler, interceptors: IHttpInterceptor[] | null = []): HttpHandler {\n\tif (!interceptors) {\n\t\treturn handler;\n\t}\n\treturn interceptors.reduceRight((next, interceptor) => new HttpInterceptorHandler(next, interceptor), handler);\n}\nexport function jsonpCallbackContext(): Object {\n\tif (typeof window === 'object') {\n\t\treturn window;\n\t}\n\treturn {};\n}\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\nimport { HttpInterceptors, IHttpInterceptor, IHttpInterceptorConstructor } from './http/http-interceptor';\n\nconst factories: typeof Factory[] = [\n];\n\nconst pipes: typeof Pipe[] = [\n];\n\n/**\n *  HttpModule Class.\n * @example\n * export default class AppModule extends Module {}\n *\n * AppModule.meta = {\n *  imports: [\n *   CoreModule,\n *    HttpModule\n *  ],\n *  declarations: [\n *   ErrorsComponent\n *  ],\n *  bootstrap: AppComponent,\n * };\n * @extends Module\n */\nexport default class HttpModule extends Module {\n\tstatic meta: IModuleMeta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\tstatic useInterceptors(interceptorFactories?: IHttpInterceptorConstructor[]): typeof HttpModule {\n\t\tif (interceptorFactories?.length) {\n\t\t\tconst interceptors: IHttpInterceptor[] = interceptorFactories?.map(x => new x());\n\t\t\tHttpInterceptors.push.apply(HttpInterceptors, interceptors);\n\t\t}\n\t\treturn this;\n\t}\n}\n","\nexport interface IHttpParamEncoder {\n\tencodeKey(key: string): string;\n\tencodeValue(value: string): string;\n\tdecodeKey(key: string): string;\n\tdecodeValue(value: string): string;\n}\n\nexport class HttpUrlEncodingCodec implements IHttpParamEncoder {\n\tencodeKey(key: string): string {\n\t\treturn encodeParam_(key);\n\t}\n\tencodeValue(value: string): string {\n\t\treturn encodeParam_(value);\n\t}\n\tdecodeKey(key: string): string {\n\t\treturn decodeURIComponent(key);\n\t}\n\tdecodeValue(value: string) {\n\t\treturn decodeURIComponent(value);\n\t}\n}\n\nexport class HttpParams {\n\tprivate params_: Map<string, string[]> = new Map<string, string[]>();\n\tprivate encoder: IHttpParamEncoder;\n\n\tconstructor(options?: HttpParams | { [key: string]: any } | string | undefined, encoder: IHttpParamEncoder = new HttpUrlEncodingCodec()) {\n\t\tthis.encoder = encoder;\n\t\tconst params = this.params_;\n\t\tif (options instanceof HttpParams) {\n\t\t\toptions.params_.forEach((value, key) => {\n\t\t\t\tparams.set(key, value);\n\t\t\t});\n\t\t} else if (typeof options === 'object') {\n\t\t\tObject.keys(options).forEach(key => {\n\t\t\t\tconst value = options[key];\n\t\t\t\tparams.set(key, Array.isArray(value) ? value : [value]);\n\t\t\t});\n\t\t} else if (typeof options === 'string') {\n\t\t\tparseRawParams_(params, options, this.encoder);\n\t\t}\n\t\t// ?updates=null&cloneFrom=null&encoder=%5Bobject%20Object%5D&params_=%5Bobject%20Map%5D\n\t}\n\n\tkeys(): string[] {\n\t\treturn Array.from(this.params_.keys());\n\t}\n\n\thas(key: string): boolean {\n\t\treturn this.params_.has(key);\n\t}\n\n\tget(key: string): string | null {\n\t\tconst value = this.params_.get(key);\n\t\treturn value ? value[0] : null;\n\t}\n\n\tgetAll(key: string): string[] | null {\n\t\treturn this.params_.get(key) || null;\n\t}\n\n\tset(key: string, value: string): HttpParams {\n\t\tconst clone = this.clone_();\n\t\tclone.params_.set(key, [value]);\n\t\treturn clone;\n\t}\n\n\tappend(key: string, value: string): HttpParams {\n\t\tconst clone = this.clone_();\n\t\tif (clone.has(key)) {\n\t\t\tconst values = clone.params_.get(key) || [];\n\t\t\tvalues.push(value);\n\t\t\tclone.params_.set(key, values);\n\t\t} else {\n\t\t\tclone.params_.set(key, [value]);\n\t\t}\n\t\treturn clone;\n\t}\n\n\tdelete(key: string): HttpParams {\n\t\tconst clone = this.clone_();\n\t\tclone.params_.delete(key);\n\t\treturn clone;\n\t}\n\n\ttoString(): string {\n\t\treturn this.keys().map((key: string) => {\n\t\t\tconst values = this.params_.get(key);\n\t\t\treturn this.encoder.encodeKey(key) + (values ? '=' + values.map(x => this.encoder.encodeValue(x)).join('&') : '');\n\t\t}).filter(keyValue => keyValue !== '').join('&');\n\t}\n\n\ttoObject(): { [keys: string]: any } {\n\t\tlet params: { [keys: string]: any } = {};\n\t\tthis.keys().map((key: string) => {\n\t\t\tconst values = this.params_.get(key);\n\t\t\tif (values) {\n\t\t\t\tparams[key] = values;\n\t\t\t}\n\t\t\t// return this.encoder.encodeKey(key) + (values ? '=' + values.map(x => this.encoder.encodeValue(x)).join('&') : '');\n\t\t});\n\t\treturn params;\n\t}\n\n\tprivate clone_(): HttpParams {\n\t\tconst clone = new HttpParams(undefined, this.encoder);\n\t\tthis.params_.forEach((value, key) => {\n\t\t\tclone.params_.set(key, value);\n\t\t});\n\t\treturn clone;\n\t}\n}\n\nfunction parseRawParams_(params: Map<string, string[]>, queryString: string, encoder: IHttpParamEncoder): Map<string, string[]> {\n\tif (queryString.length > 0) {\n\t\tconst keyValueParams: string[] = queryString.split('&');\n\t\tkeyValueParams.forEach((keyValue: string) => {\n\t\t\tconst index = keyValue.indexOf('=');\n\t\t\tconst [key, value]: string[] = index == -1 ? [encoder.decodeKey(keyValue), ''] : [encoder.decodeKey(keyValue.slice(0, index)), encoder.decodeValue(keyValue.slice(index + 1))];\n\t\t\tconst values = params.get(key) || [];\n\t\t\tvalues.push(value);\n\t\t\tparams.set(key, values);\n\t\t});\n\t}\n\treturn params;\n}\n\nfunction encodeParam_(v: string): string {\n\treturn encodeURIComponent(v)\n\t\t.replace(/%40/gi, '@')\n\t\t.replace(/%3A/gi, ':')\n\t\t.replace(/%24/gi, '$')\n\t\t.replace(/%2C/gi, ',')\n\t\t.replace(/%3B/gi, ';')\n\t\t.replace(/%2B/gi, '+')\n\t\t.replace(/%3D/gi, '=')\n\t\t.replace(/%3F/gi, '?')\n\t\t.replace(/%2F/gi, '/');\n}\n","import { getLocationComponents, optionsToKey } from 'rxcomp';\nimport { HttpHeaders } from './http-headers';\nimport { HttpParams } from './http-params';\n\nexport type HttpMethodType = 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' | 'OPTIONS' | 'HEAD' | 'JSONP';\nexport type HttpMethodBodyType = 'POST' | 'PUT' | 'PATCH';\nexport type HttpMethodNoBodyType = 'GET' | 'DELETE' | 'OPTIONS' | 'HEAD' | 'JSONP';\nexport type HttpResponseType = 'arraybuffer' | 'blob' | 'json' | 'text';\nexport type HttpBodyType<T> = T | string | Blob | ArrayBufferView | ArrayBuffer | FormData | URLSearchParams | ReadableStream<Uint8Array> | null | undefined;\nexport type HttpObserveType = 'body' | 'events' | 'response';\n\nexport interface IHttpRequestInit<T> {\n\theaders?: HttpHeaders | Headers | { [key: string]: string | string[] } | string | undefined;\n\treportProgress?: boolean;\n\tparams?: HttpParams | { [key: string]: any } | string | undefined;\n\tresponseType?: HttpResponseType;\n\twithCredentials?: boolean;\n\thydrate?: boolean;\n\tobserve?: HttpObserveType;\n\tbody?: HttpBodyType<T>;\n}\n\nexport interface IHttpRequest<T> extends IHttpRequestInit<T> {\n\tmethod?: HttpMethodType,\n\turl?: string,\n}\n\nexport class HttpRequest<T> {\n\treadonly body: HttpBodyType<T>;\n\treadonly headers!: HttpHeaders;\n\treadonly reportProgress: boolean = false;\n\treadonly withCredentials: boolean = false;\n\treadonly hydrate: boolean = true;\n\treadonly observe: HttpObserveType = 'body';\n\treadonly responseType: HttpResponseType = 'json';\n\treadonly method: HttpMethodType;\n\treadonly params!: HttpParams;\n\treadonly urlWithParams: string;\n\tget transferKey(): string {\n\t\tconst pathname: string = getLocationComponents(this.url).pathname;\n\t\tconst paramsKey: string = optionsToKey(this.params.toObject());\n\t\tconst bodyKey: string = optionsToKey(this.body);\n\t\tlet key: string = `${this.method}-${pathname}-${paramsKey}-${bodyKey}`;\n\t\tkey = key.replace(/(\\s+)|(\\W+)/g, function (...matches) { return matches[1] ? '' : '_' });\n\t\t// console.log('transferKey', key);\n\t\treturn key;\n\t}\n\tconstructor(method: HttpMethodNoBodyType, url: string, options?: IHttpRequestInit<T>);\n\tconstructor(method: HttpMethodBodyType, url: string, body: HttpBodyType<T>, options?: IHttpRequestInit<T>);\n\tconstructor(method: HttpMethodType, url: string, body: HttpBodyType<T>, options?: IHttpRequestInit<T>);\n\tconstructor(method: HttpMethodType, readonly url: string, third?: HttpBodyType<T> | IHttpRequestInit<T> | null, fourth?: IHttpRequestInit<T>) {\n\t\t// !!! remove, rethink\n\t\tconst isStaticFile: boolean = /\\.(json|xml|txt)(\\?.*)?$/.test(url);\n\t\tthis.method = isStaticFile ? 'GET' : method.toUpperCase() as HttpMethodType;\n\t\tlet options: IHttpRequestInit<T> | undefined;\n\t\tif (methodHasBody_(this.method) || !!fourth) {\n\t\t\tthis.body = (third !== undefined) ? third as HttpBodyType<T> : null;\n\t\t\toptions = fourth;\n\t\t} else {\n\t\t\toptions = third as IHttpRequestInit<T>;\n\t\t}\n\t\tif (options) {\n\t\t\tthis.reportProgress = !!options.reportProgress;\n\t\t\tthis.withCredentials = !!options.withCredentials;\n\t\t\tthis.observe = options.observe || this.observe;\n\t\t\tif (options.responseType) {\n\t\t\t\tthis.responseType = options.responseType;\n\t\t\t}\n\t\t\tif (options.headers) {\n\t\t\t\tthis.headers = new HttpHeaders(options.headers);\n\t\t\t}\n\t\t\tif (options.params) {\n\t\t\t\tthis.params = new HttpParams(options.params);\n\t\t\t}\n\t\t}\n\t\tif (!this.headers) {\n\t\t\tthis.headers = new HttpHeaders();\n\t\t}\n\t\tif (!this.params) {\n\t\t\tthis.params = new HttpParams();\n\t\t}\n\t\tconst params = this.params.toString();\n\t\tconst index = url.indexOf('?');\n\t\tconst sep: string = index === -1 ? '?' : (index < url.length - 1 ? '&' : '');\n\t\tthis.urlWithParams = url + (params.length ? sep + params : params);\n\t}\n\tserializeBody(): ArrayBuffer | Blob | FormData | string | null {\n\t\tif (this.body === null) {\n\t\t\treturn null;\n\t\t}\n\t\tif (isArrayBuffer_(this.body) || isBlob_(this.body) || isFormData_(this.body) ||\n\t\t\ttypeof this.body === 'string') {\n\t\t\treturn this.body;\n\t\t}\n\t\tif (this.body instanceof HttpParams) {\n\t\t\treturn (<any>this.body).toString();\n\t\t}\n\t\tif (typeof this.body === 'object' || typeof this.body === 'boolean' || Array.isArray(this.body)) {\n\t\t\treturn JSON.stringify(this.body);\n\t\t}\n\t\treturn (this.body as any).toString();\n\t}\n\tdetectContentTypeHeader(): string | null {\n\t\tif (this.body === null) {\n\t\t\treturn null;\n\t\t}\n\t\tif (isFormData_(this.body)) {\n\t\t\treturn null;\n\t\t}\n\t\tif (isBlob_(this.body)) {\n\t\t\treturn this.body.type || null;\n\t\t}\n\t\tif (isArrayBuffer_(this.body)) {\n\t\t\treturn null;\n\t\t}\n\t\tif (typeof this.body === 'string') {\n\t\t\treturn 'text/plain';\n\t\t}\n\t\tif (this.body instanceof HttpParams) {\n\t\t\treturn 'application/x-www-form-urlencoded;charset=UTF-8';\n\t\t}\n\t\tif (typeof this.body === 'object' || typeof this.body === 'number' ||\n\t\t\tArray.isArray(this.body)) {\n\t\t\treturn 'application/json';\n\t\t}\n\t\treturn null;\n\t}\n\ttoInitRequest(): RequestInit {\n\t\treturn {\n\t\t\tmethod: this.method,\n\t\t\theaders: this.headers.serialize(),\n\t\t\tbody: this.serializeBody(),\n\t\t\tmode: 'same-origin', // 'cors' | 'navigate' | 'no-cors' | 'same-origin',\n\t\t\tcredentials: 'same-origin',\n\t\t\tcache: 'default', // 'default' | 'force-cache' | 'no-cache' | 'no-store' | 'only-if-cached' | 'reload',\n\t\t\tredirect: 'error', // 'error' | 'follow' | 'manual';\n\t\t\t// referrer: '',\n\t\t\t// integrity: '',\n\t\t\t// keepalive: false,\n\t\t\t// referrerPolicy: ''; // '' | 'no-referrer' | 'no-referrer-when-downgrade' | 'origin' | 'origin-when-cross-origin' | 'same-origin' | 'strict-origin' | 'strict-origin-when-cross-origin' | 'unsafe-url',\n\t\t\t// signal: null,\n\t\t\t// window,\n\t\t\t// method: The request method, e.g., GET, POST. The default is GET.\n\t\t\t// headers: Any headers you want to add to your request, contained within a Headers object or an object literal with ByteString values.\n\t\t\t// body: Any body that you want to add to your request: this can be a Blob, BufferSource, FormData, URLSearchParams, USVString, or ReadableStream object. Note that a request using the GET or HEAD method cannot have a body.\n\t\t\t// mode: The mode you want to use for the request, e.g., cors, no-cors, same-origin, or navigate. The default is cors.\n\t\t\t// credentials: The request credentials you want to use for the request: omit, same-origin, or include. The default is same-origin.\n\t\t\t// cache: The cache mode you want to use for the request.\n\t\t\t// redirect: The redirect mode to use: follow, error, or manual. The default is follow.\n\t\t\t// referrer: A USVString specifying no-referrer, client, or a URL. The default is about:client.\n\t\t\t// integrity: Contains the subresource integrity value of the request (e.g., sha256-BpfBw7ivV8q2jLiT13fxDYAe2tJllusRSZ273h2nFSE=).\n\t\t}\n\t}\n\ttoFetchRequest__(): Request {\n\t\treturn new Request(this.urlWithParams, this.toInitRequest());\n\t\t/*\n\t\tRequest.cache Read only\n\t\tContains the cache mode of the request (e.g., default, reload, no-cache).\n\t\tRequest.context Read only\n\t\tContains the context of the request (e.g., audio, image, iframe, etc.)\n\t\tRequest.credentials Read only\n\t\tContains the credentials of the request (e.g., omit, same-origin, include). The default is same-origin.\n\t\tRequest.destination Read only\n\t\tReturns a string from the RequestDestination enum describing the request's destination. This is a string indicating the type of content being requested.\n\t\tRequest.headers Read only\n\t\tContains the associated Headers object of the request.\n\t\tRequest.integrity Read only\n\t\tContains the subresource integrity value of the request (e.g., sha256-BpfBw7ivV8q2jLiT13fxDYAe2tJllusRSZ273h2nFSE=).\n\t\tRequest.method Read only\n\t\tContains the request's method (GET, POST, etc.)\n\t\tRequest.mode Read only\n\t\tContains the mode of the request (e.g., cors, no-cors, same-origin, navigate.)\n\t\tRequest.redirect Read only\n\t\tContains the mode for how redirects are handled. It may be one of follow, error, or manual.\n\t\tRequest.referrer Read only\n\t\tContains the referrer of the request (e.g., client).\n\t\tRequest.referrerPolicy Read only\n\t\tContains the referrer policy of the request (e.g., no-referrer).\n\t\tRequest.url Read only\n\t\tContains the URL of the request.\n\t\tRequest implements Body, so it also inherits the following properties:\n\t\tbody Read only\n\t\tA simple getter used to expose a ReadableStream of the body contents.\n\t\tbodyUsed Read only\n\t\tStores a Boolean that declares whether the body has been used in a response yet.\n\t\t*/\n\t}\n\tclone<T>(options?: IHttpRequest<T>): HttpRequest<T> {\n\t\toptions = Object.assign({\n\t\t\theaders: this.headers,\n\t\t\treportProgress: this.reportProgress,\n\t\t\tparams: this.params,\n\t\t\tresponseType: this.responseType,\n\t\t\twithCredentials: this.withCredentials,\n\t\t\tobserve: this.observe,\n\t\t\tbody: this.body,\n\t\t\turl: this.url,\n\t\t\tmethod: this.method,\n\t\t}, options || {}) as IHttpRequestInit<T>;\n\t\tconst clone = new HttpRequest<T>(this.method as HttpMethodBodyType, this.url, this.body as HttpBodyType<T>, options);\n\t\treturn clone;\n\t}\n\ttoObject(): { [key: string]: any } {\n\t\tconst request: { [key: string]: any } = {};\n\t\trequest.url = this.url;\n\t\trequest.method = this.method;\n\t\trequest.headers = this.headers.toObject();\n\t\trequest.params = this.params.toObject();\n\t\trequest.body = this.body;\n\t\trequest.reportProgress = this.reportProgress;\n\t\trequest.responseType = this.responseType;\n\t\trequest.withCredentials = this.withCredentials;\n\t\trequest.observe = this.observe;\n\t\treturn request;\n\t}\n}\n\nfunction methodHasBody_(method: string): boolean {\n\tswitch (method) {\n\t\tcase 'DELETE':\n\t\tcase 'GET':\n\t\tcase 'HEAD':\n\t\tcase 'OPTIONS':\n\t\tcase 'JSONP':\n\t\t\treturn false;\n\t\tdefault:\n\t\t\treturn true;\n\t}\n}\n\nfunction isArrayBuffer_(value: any): value is ArrayBuffer {\n\treturn typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer;\n}\n\nfunction isBlob_(value: any): value is Blob {\n\treturn typeof Blob !== 'undefined' && value instanceof Blob;\n}\n\nfunction isFormData_(value: any): value is FormData {\n\treturn typeof FormData !== 'undefined' && value instanceof FormData;\n}\n","import { BehaviorSubject, Observable, of, throwError } from 'rxjs';\nimport { catchError, concatMap, filter, finalize, map } from 'rxjs/operators';\nimport { HttpErrorResponse, IHttpErrorResponse } from './http-error-response';\nimport { HttpHeaders } from './http-headers';\nimport { HttpInterceptingHandler } from './http-interceptor';\nimport { HttpParams } from './http-params';\nimport { HttpBodyType, HttpMethodType, HttpRequest, IHttpRequestInit } from './http-request';\nimport { HttpEvent, HttpResponse } from './http-response';\n\nexport default class HttpService {\n\n\tstatic pendingRequests$: BehaviorSubject<number> = new BehaviorSubject<number>(0);\n\n\tstatic incrementPendingRequest() {\n\t\tHttpService.pendingRequests$.next(HttpService.pendingRequests$.getValue() + 1);\n\t}\n\n\tstatic decrementPendingRequest() {\n\t\tHttpService.pendingRequests$.next(HttpService.pendingRequests$.getValue() - 1);\n\t}\n\n\t// static handler: HttpHandler = new HttpFetchHandler();\n\tstatic handler: HttpInterceptingHandler = new HttpInterceptingHandler();\n\n\tstatic request$<T>(first: HttpMethodType | HttpRequest<T>, url?: string, options: IHttpRequestInit<T> = {}): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>> {\n\t\tlet request: HttpRequest<T>;\n\t\tif (first instanceof HttpRequest) {\n\t\t\trequest = first;\n\t\t} else {\n\t\t\tlet headers: HttpHeaders | undefined = undefined;\n\t\t\tif (options.headers instanceof HttpHeaders) {\n\t\t\t\theaders = options.headers;\n\t\t\t} else {\n\t\t\t\theaders = new HttpHeaders(options.headers);\n\t\t\t}\n\t\t\tlet params: HttpParams | undefined = undefined;\n\t\t\tif (options.params) {\n\t\t\t\tparams = new HttpParams(options.params);\n\t\t\t}\n\t\t\trequest = new HttpRequest(first, url!, (options.body !== undefined ? options.body : null), {\n\t\t\t\theaders,\n\t\t\t\tparams,\n\t\t\t\treportProgress: options.reportProgress,\n\t\t\t\tresponseType: options.responseType || 'json',\n\t\t\t\twithCredentials: options.withCredentials,\n\t\t\t});\n\t\t}\n\t\t// console.log('HttpService.request$', request);\n\t\tHttpService.incrementPendingRequest();\n\t\tconst events$: Observable<HttpEvent<any>> = of(request).pipe(\n\t\t\tconcatMap((request: HttpRequest<T>) => this.handler.handle(request)),\n\t\t\t// tap((response: HttpEvent<any>) => console.log('HttpService.response', response)),\n\t\t\tfinalize(() => HttpService.decrementPendingRequest())\n\t\t);\n\t\tif (first instanceof HttpRequest || options.observe === 'events') {\n\t\t\treturn events$.pipe(\n\t\t\t\tcatchError(error => {\n\t\t\t\t\tconsole.log('error', error);\n\t\t\t\t\treturn throwError(this.getError(error, null, request));\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\tconst response$: Observable<HttpResponse<T>> = <Observable<HttpResponse<T>>>events$.pipe(\n\t\t\tfilter((event: HttpEvent<any>) => event instanceof HttpResponse),\n\t\t);\n\t\tlet response_: HttpResponse<T>;\n\t\tconst observe$: Observable<HttpResponse<T> | HttpBodyType<T>> = response$.pipe(\n\t\t\tmap((response: HttpResponse<T>) => {\n\t\t\t\tresponse_ = response;\n\t\t\t\tswitch (options.observe || 'body') {\n\t\t\t\t\tcase 'body':\n\t\t\t\t\t\tswitch (request.responseType) {\n\t\t\t\t\t\t\tcase 'arraybuffer':\n\t\t\t\t\t\t\t\tif (response.body !== null && !(response.body instanceof ArrayBuffer)) {\n\t\t\t\t\t\t\t\t\tthrow new Error('Response is not an ArrayBuffer.');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t\tcase 'blob':\n\t\t\t\t\t\t\t\tif (response.body !== null && !(response.body instanceof Blob)) {\n\t\t\t\t\t\t\t\t\tthrow new Error('Response is not a Blob.');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\t\tif (response.body !== null && typeof response.body !== 'string') {\n\t\t\t\t\t\t\t\t\tthrow new Error('Response is not a string.');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t}\n\t\t\t\t\tcase 'response':\n\t\t\t\t\t\treturn response;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unreachable: unhandled observe type ${options.observe}}`);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tcatchError(error => {\n\t\t\t\tconsole.log('error', error);\n\t\t\t\treturn throwError(this.getError(error, response_, request));\n\t\t\t}),\n\t\t)\n\t\treturn observe$;\n\t\t/*\n\t\tswitch (options.observe || 'body') {\n\t\t\tcase 'body':\n\t\t\t\tswitch (request.responseType) {\n\t\t\t\t\tcase 'arraybuffer':\n\t\t\t\t\t\treturn response$.pipe(map((response: HttpResponse<T>) => {\n\t\t\t\t\t\t\tif (response.body !== null && !(response.body instanceof ArrayBuffer)) {\n\t\t\t\t\t\t\t\tthrow new Error('Response is not an ArrayBuffer.');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t}));\n\t\t\t\t\tcase 'blob':\n\t\t\t\t\t\treturn response$.pipe(map((response: HttpResponse<T>) => {\n\t\t\t\t\t\t\tif (response.body !== null && !(response.body instanceof Blob)) {\n\t\t\t\t\t\t\t\tthrow new Error('Response is not a Blob.');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t}));\n\t\t\t\t\tcase 'text':\n\t\t\t\t\t\treturn response$.pipe(map((response: HttpResponse<T>) => {\n\t\t\t\t\t\t\tif (response.body !== null && typeof response.body !== 'string') {\n\t\t\t\t\t\t\t\tthrow new Error('Response is not a string.');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn response.body;\n\t\t\t\t\t\t}));\n\t\t\t\t\tcase 'json':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn response$.pipe(map((response: HttpResponse<T>) => response.body));\n\t\t\t\t}\n\t\t\tcase 'response':\n\t\t\t\treturn response$;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unreachable: unhandled observe type ${options.observe}}`);\n\t\t}\n\t\t*/\n\t}\n\n\tstatic delete$<T>(url: string, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic delete$<T>(url: string, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic delete$(url: string, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('DELETE', url, options);\n\t}\n\n\tstatic get$<T>(url: string, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic get$<T>(url: string, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic get$(url: string, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('GET', url, options);\n\t}\n\n\tstatic head$<T>(url: string, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic head$<T>(url: string, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic head$(url: string, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('HEAD', url, options);\n\t}\n\n\tstatic jsonp$<T>(url: string, callbackParam: string): Observable<T>;\n\tstatic jsonp$<T>(url: string, callbackParam: string): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic jsonp$(url: string, callbackParam: string): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('JSONP', url, {\n\t\t\tparams: new HttpParams().append(callbackParam, 'JSONP_CALLBACK'),\n\t\t\tobserve: 'body',\n\t\t\tresponseType: 'json',\n\t\t});\n\t}\n\n\tstatic options$<T>(url: string, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic options$<T>(url: string, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic options$(url: string, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('OPTIONS', url, options);\n\t}\n\n\tstatic patch$<T>(url: string, body: any | null, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic patch$<T>(url: string, body: any | null, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic patch$(url: string, body: any | null, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('PATCH', url, optionsWithBody_<any>(options, body));\n\t}\n\n\tstatic post$<T>(url: string, body: any | null, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic post$<T>(url: string, body: any | null, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic post$(url: string, body: any | null, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('POST', url, optionsWithBody_<any>(options, body));\n\t}\n\n\tstatic put$<T>(url: string, body: any | null, options?: IHttpRequestInit<T>): Observable<T>;\n\tstatic put$<T>(url: string, body: any | null, options: IHttpRequestInit<T>): Observable<HttpEvent<any> | HttpResponse<T> | HttpBodyType<T>>;\n\tstatic put$(url: string, body: any | null, options: IHttpRequestInit<any> = {}): Observable<HttpEvent<any> | HttpResponse<any> | HttpBodyType<any>> {\n\t\treturn this.request$<any>('PUT', url, optionsWithBody_<any>(options, body));\n\t}\n\n\tstatic getError<T>(error: any, response: HttpResponse<T> | null, request: HttpRequest<T> | null): HttpErrorResponse<T> {\n\t\tif (!error.status) {\n\t\t\terror.statusCode = response?.status || 0;\n\t\t}\n\t\tif (!error.statusMessage) {\n\t\t\terror.statusMessage = response?.statusText || 'Unknown Error';\n\t\t}\n\t\tconst options: IHttpErrorResponse<T> = {\n\t\t\terror,\n\t\t\tstatus: error.status,\n\t\t\tstatusText: error.statusText,\n\t\t\tmessage: error.message,\n\t\t\trequest,\n\t\t};\n\t\tif (response) {\n\t\t\toptions.headers = response.headers;\n\t\t\toptions.status = options.status || response.status;\n\t\t\toptions.statusText = options.statusText || response.statusText;\n\t\t\toptions.url = response.url;\n\t\t}\n\t\treturn new HttpErrorResponse<T>(options);\n\t}\n\n}\n\nfunction optionsWithBody_<T>(options: IHttpRequestInit<T>, body: T | null): IHttpRequestInit<T> {\n\treturn Object.assign({}, options, { body });\n}\n","import { Component, errors$, getContext, IFactoryMeta } from 'rxcomp';\nimport { first, takeUntil } from 'rxjs/operators';\nimport { HttpService } from '../../../src/rxcomp-http';\nimport { IResponseData, ITodoItem } from './todo/todo';\n\nexport default class AppComponent extends Component {\n\titems: ITodoItem[] = [];\n\terror: any = null;\n\n\tonInit() {\n\t\t// console.log('AppComponent.onInit', this);\n\t\tconst { node } = getContext(this);\n\t\tnode.classList.add('init');\n\t\t/*\n\t\tconst payload = { query: `{ hello }` };\n\t\t*/\n\t\t/*\n\t\tconst payload = { query: `{ roll(dices: ${3}, sides: ${6}) }` };\n\t\t*/\n\t\t/*\n\t\tconst payload = {\n\t\t\tquery: `query ($dices: Int!, $sides: Int) {\n\t\t\troll(dices: $dices, sides: $sides)\n\t\t}`, variables: { dices: 3, sides: 6 }\n\t\t};\n\t\t*/\n\t\t/*\n\t\tconst payload = { query: `{ getTodos { id, title, completed } }` };\n\t\t*/\n\t\t/*\n\t\tHttpService.post$<IResponseData>(`${Vars.host}${Vars.api}`, payload, {\n\t\t\tparams: { query: `{ getTodos { id, title, completed } }` },\n\t\t\treportProgress: true\n\t\t}).pipe(\n\t\t*/\n\t\t/*\n\t\tconst methodUrl: string = `${Vars.host}${Vars.api}`;\n\t\tHttpService.post$<IResponseData>(methodUrl, payload).pipe(\n\t\t\tfirst(),\n\t\t).subscribe((response: IResponseData) => {\n\t\t\tthis.items = response.data.getTodos;\n\t\t\tthis.pushChanges();\n\t\t\t// console.log('AppComponent.getTodos', this.items);\n\t\t}, error => console.log);\n\t\t*/\n\t\t/*\n\t\tHttpService.get$(`${Vars.host}/data/todos.json`).pipe(\n\t\t\tfirst(),\n\t\t).subscribe(response => {\n\t\t\t// console.log('AppComponent.items', response);\n\t\t\tthis.items = response.data;\n\t\t\tthis.pushChanges();\n\t\t});\n\t\t*/\n\t\tconst methodUrl: string = `/rxcomp-http/data/get-todos.json`;\n\t\tHttpService.get$<IResponseData>(methodUrl).pipe(\n\t\t\tfirst(),\n\t\t).subscribe((response: IResponseData) => {\n\t\t\tthis.items = response.data.getTodos;\n\t\t\tthis.pushChanges();\n\t\t\t// console.log('AppComponent.getTodos', this.items);\n\t\t}, error => console.log);\n\t\t// HttpService.get$(`https://jsonplaceholder.typicode.com/users/1/todos`).pipe(\n\t\terrors$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$),\n\t\t).subscribe(error => {\n\t\t\tthis.error = error;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tonClick(item: { title: string, completed: boolean }) {\n\t\titem.completed = !item.completed;\n\t\tthis.pushChanges();\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: '[app-component]',\n\t};\n\n}\n","\nimport { EMPTY, Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { HttpEvent, HttpHandler, HttpRequest, HttpResponse, IHttpInterceptor } from '../../../../src/rxcomp-http';\n\nconst cancelRequest: boolean = false;\n\nexport class CustomRequestInterceptor implements IHttpInterceptor {\n\tintercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n\t\tif (cancelRequest) {\n\t\t\treturn EMPTY;\n\t\t}\n\t\treturn next.handle(request);\n\t}\n}\n\nexport class CustomResponseInterceptor implements IHttpInterceptor {\n\tintercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n\t\treturn next.handle(request).pipe(\n\t\t\ttap(event => {\n\t\t\t\tif (event instanceof HttpResponse) {\n\t\t\t\t\tconsole.log('CustomResponseInterceptor.status', event.status);\n\t\t\t\t\tconsole.log('CustomResponseInterceptor.filter', request.params.get('filter'));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n\nexport class CustomRequestCloneInterceptor implements IHttpInterceptor {\n\tintercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n\t\tconst clonedRequest = request.clone({\n\t\t\turl: request.url,\n\t\t});\n\t\treturn next.handle(clonedRequest);\n\t}\n}\n","import { CoreModule, IModuleMeta, Module } from 'rxcomp';\nimport { HttpModule } from '../../../src/rxcomp-http';\nimport AppComponent from './app.component';\nimport { CustomRequestInterceptor, CustomResponseInterceptor } from './http/custom.interceptor';\n\nexport default class AppModule extends Module {\n\n\tstatic meta: IModuleMeta = {\n\t\timports: [\n\t\t\tCoreModule,\n\t\t\tHttpModule.useInterceptors([\n\t\t\t\tCustomRequestInterceptor,\n\t\t\t\tCustomResponseInterceptor,\n\t\t\t]),\n\t\t],\n\t\tdeclarations: [\n\t\t],\n\t\tbootstrap: AppComponent,\n\t};\n\n}\n","import { Browser } from 'rxcomp';\nimport AppModule from './app.module';\n\nBrowser.bootstrap(AppModule);\n"]}