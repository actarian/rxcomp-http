/**
 * @license rxcomp-http v1.0.0-beta.19
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,r){return(u=a()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return r&&i(s,r.prototype),s}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,o(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i(n,e)})(e)}var h;!function(e){e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e[e.ResponseError=6]="ResponseError"}(h||(h={}));var p=function(){function e(t){var r=this;this.headers_=new Map;var n=this.headers_;t instanceof e?t.headers_.forEach((function(e,t){n.set(t,e)})):"function"==typeof(null==t?void 0:t.forEach)?t.forEach((function(e,t){n.set(t,e.split(", "))})):"object"==typeof t?Object.keys(t).forEach((function(e){var s=t[e];"string"==typeof s&&(s=[s]),n.has(e)?s.forEach((function(t){return r.append(e,t)})):n.set(e,s)})):"string"==typeof t&&t.split("\n").forEach((function(e){var t=e.indexOf(":");if(t>0){var s=e.slice(0,t),o=e.slice(t+1).trim();n.has(s)?r.append(s,o):n.set(s,[o])}})),n.has("Accept")||n.set("Accept",["application/json","text/plain","*/*"]),n.has("Content-Type")||n.set("Content-Type",["application/json"])}var t=e.prototype;return t.has=function(e){return this.headers_.has(e)},t.get=function(e){var t=this.headers_.get(e);return t?t.join(", "):null},t.set=function(e,t){var r=this.clone_();return r.headers_.set(e,t.split(", ")),r},t.append=function(e,t){var r=this.clone_(),n=r.headers_.has(e)&&r.headers_.get(e)||[];return n.push(t),r.headers_.set(e,n),r},t.delete=function(e){var t=this.clone_();return t.headers_.delete(e),t},t.forEach=function(e,t){var r=this;this.headers_.forEach((function(t,n){e(t.join(", "),n,r)}))},t.serialize=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),e},t.toObject=function(){var e={};return this.forEach((function(t,r){e[r]=t})),e},t.clone_=function(){var t=new e;return this.headers_.forEach((function(e,r){t.headers_.set(r,e)})),t},e}(),f=function(e){function t(t){var r;return(r=e.call(this,(null==t?void 0:t.message)||"Unknown Error")||this).status=0,r.statusText="Unknown Error",r.ok=!1,r.type=h.ResponseError,r.message="Unknown Error",r.name="HttpErrorResponse",t&&(r.headers=new p(t.headers),r.status=t.status||r.status,r.statusText=t.statusText||r.statusText,r.url=t.url||r.url,r.error=t.error||r.error,r.name=t.name||r.name,r.request=t.request||null),r}return s(t,e),t.prototype.clone=function(e){var r=new t(e=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,error:this.error,message:this.message,name:this.name,request:this.request},e||{}));return r},t}(c(Error)),d=function(){function e(e){this.status=200,this.statusText="OK",this.type=h.Response,this.body=null,e&&(this.headers=new p(e.headers),this.status=e.status||this.status,this.statusText=e.statusText||this.statusText,this.url=e.url||this.url,this.body=e.body||this.body),this.ok=this.status>=200&&this.status<300}var t=e.prototype;return t.clone=function(t){var r=new e(t=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,ok:this.ok,type:this.type,body:this.body},t||{}));return r},t.toObject=function(){var e={};return e.url=this.url,e.headers=this.headers.toObject(),e.status=this.status,e.statusText=this.statusText,e.ok=this.ok,e.type=this.type,e.body=this.body,e},e}(),l=function(){function n(){this.response_=null}var s=n.prototype;return s.handle=function(n){var s=this;if(!n.method)throw new Error("missing method");var o,i=n.urlWithParams,a=n.toInitRequest(),u=e.TransferService.makeKey(n.transferKey);if(e.isPlatformBrowser&&n.hydrate&&e.TransferService.has(u)){var c=e.TransferService.get(u);c&&(o=new d(c)),e.TransferService.remove(u)}return o?t.of(o):t.from(fetch(i,a).then((function(e){return s.getProgress(e,n)})).then((function(e){return s.getResponse(e,n)}))).pipe(r.tap((function(t){e.isPlatformServer&&n.hydrate&&e.TransferService.set(u,t.toObject())})),r.catchError((function(r){var o={error:r};s.response_&&(o.headers=s.response_.headers,o.status=s.response_.status,o.statusText=s.response_.statusText,o.url=s.response_.url,o.request=n);var i=new f(o);return e.nextError$.next(i),t.of(s.response_)})),r.finalize((function(){s.response_=null})))},s.getProgress=function(t,r){var n=this,s=t.clone().body;if(e.isPlatformBrowser&&r.reportProgress&&s){var o=s.getReader(),i=t.headers&&t.headers.has("Content-Length")?+(t.headers.get("Content-Length")||0):0;return new Promise((function(e,s){var a={progress:0,percent:0,current:0,total:0};o.read().then((function(e){return function e(r,n){var s=a.current;return n?(a.total=i,a.current=i,a.progress=1,a.percent=100,o.closed.then((function(){return t.clone()}))):(r&&(s+=r.length||0,a.total=i,a.current=s,a.progress=s/i,a.percent=100*a.progress),o.read().then((function(t){var r=t.value,n=t.done;return e(r,n)})))}(e.value,e.done)})).then((function(t){return n.response_=new d(t),"function"==typeof t[r.responseType]?t[r.responseType]().then((function(r){return n.response_=new d(Object.assign(n.response_,{body:r})),t.ok?e(n.response_):s(n.response_)})):s(n.response_)})).catch((function(e){return console.log("upload error:",e)}))}))}return Promise.resolve(t)},s.getResponse=function(t,r){return this.response_=new d(t),e.isPlatformBrowser&&r.reportProgress&&t.body?Promise.resolve(this.response_):this.getResponseType(t,r)},s.getResponseType=function(e,t){var r=this;return new Promise((function(n,s){return r.response_=new d(e),"function"==typeof e[t.responseType]?e[t.responseType]().then((function(t){return r.response_=new d(Object.assign(r.response_,{body:t})),e.ok?n(r.response_):s(r.response_)})):s(r.response_)}))},s.getReadableStream=function(e,t){var r=e.body.getReader();return new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var n=r.done,s=r.value;n?e.close():(e.enqueue(s),t())}))}()}})},n}(),y=function(){function e(e,t){this.next=e,this.interceptor=t}return e.prototype.handle=function(e){return this.interceptor.intercept(e,this.next)},e}(),b=[],v=new l,g=function(){function e(){this.chain=null}return e.prototype.handle=function(e){if(null===this.chain){var t=b;this.chain=t.reduceRight((function(e,t){return new y(e,t)}),v)}return this.chain.handle(e)},e}(),m=[],w=[],_=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.useInterceptors=function(e){if(null==e?void 0:e.length){var t=null==e?void 0:e.map((function(e){return new e}));b.push.apply(b,t)}return this},t}(e.Module);_.meta={declarations:[].concat(m,w),exports:[].concat(m,w)};var T=function(){function e(){}var t=e.prototype;return t.encodeKey=function(e){return R(e)},t.decodeKey=function(e){return decodeURIComponent(e)},t.encodeValue=function(e){return R(e)},t.decodeValue=function(e){return decodeURIComponent(e)},e}(),E=function(){function t(){}var r=t.prototype;return r.encodeKey=function(e){return R(e)},r.decodeKey=function(e){return decodeURIComponent(e)},r.encodeValue=function(t){return e.Serializer.encode(t,[e.encodeJson,encodeURIComponent,e.encodeBase64])||""},r.decodeValue=function(t){return e.Serializer.decode(t,[e.decodeBase64,decodeURIComponent,e.decodeJson])||""},t}();function R(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var x=function(){function e(t,r){void 0===r&&(r=new T),this.params_=new Map,this.encoder=r;var n=this.params_;t instanceof e?t.params_.forEach((function(e,t){n.set(t,e)})):"object"==typeof t?Object.keys(t).forEach((function(e){var r=t[e];n.set(e,Array.isArray(r)?r:[r])})):"string"==typeof t&&function(e,t,r){t.length>0&&t.split("&").forEach((function(t){var n=t.indexOf("="),s=-1==n?[r.decodeKey(t),""]:[r.decodeKey(t.slice(0,n)),r.decodeValue(t.slice(n+1))],o=s[0],i=s[1],a=e.get(o)||[];a.push(i),e.set(o,a)}))}(n,t,this.encoder)}var t=e.prototype;return t.keys=function(){return Array.from(this.params_.keys())},t.has=function(e){return this.params_.has(e)},t.get=function(e){var t=this.params_.get(e);return t?t[0]:null},t.getAll=function(e){return this.params_.get(e)||null},t.set=function(e,t){var r=this.clone_();return r.params_.set(e,[t]),r},t.append=function(e,t){var r=this.clone_();if(r.has(e)){var n=r.params_.get(e)||[];n.push(t),r.params_.set(e,n)}else r.params_.set(e,[t]);return r},t.delete=function(e){var t=this.clone_();return t.params_.delete(e),t},t.toString=function(){var e=this;return this.keys().map((function(t){var r=e.params_.get(t);return e.encoder.encodeKey(t)+(r?"="+r.map((function(t){return e.encoder.encodeValue(t)})).join("&"):"")})).filter((function(e){return""!==e})).join("&")},t.toObject=function(){var e=this,t={};return this.keys().map((function(r){var n=e.params_.get(r);n&&(t[r]=n)})),t},t.clone_=function(){var t=new e(void 0,this.encoder);return this.params_.forEach((function(e,r){t.params_.set(r,e)})),t},e}(),P=function(){function t(e,t,r,n){this.url=t,this.reportProgress=!1,this.withCredentials=!1,this.hydrate=!0,this.observe="body",this.responseType="json";var s,o=/\.(json|xml|txt)(\?.*)?$/.test(t);this.method=o?"GET":e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,s=n):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,this.observe=s.observe||this.observe,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=new p(s.headers)),s.params&&(this.params=s.params instanceof x?s.params:new x(s.params,s.paramsEncoder))),this.headers||(this.headers=new p),this.params||(this.params=new x);var i=this.params.toString(),a=t.indexOf("?"),u=-1===a?"?":a<t.length-1?"&":"";this.urlWithParams=t+(i.length?u+i:i)}var r,s,o,i=t.prototype;return i.serializeBody=function(){return null===this.body?null:j(this.body)||O(this.body)||C(this.body)||"string"==typeof this.body?this.body:this.body instanceof x?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()},i.detectContentTypeHeader=function(){return null===this.body||C(this.body)?null:O(this.body)?this.body.type||null:j(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof x?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null},i.toInitRequest=function(){return{method:this.method,headers:this.headers.serialize(),body:this.serializeBody(),mode:"same-origin",credentials:"same-origin",cache:"default",redirect:"error"}},i.toFetchRequest__=function(){return new Request(this.urlWithParams,this.toInitRequest())},i.clone=function(e){e=Object.assign({headers:this.headers,reportProgress:this.reportProgress,params:this.params,responseType:this.responseType,withCredentials:this.withCredentials,observe:this.observe,body:this.body,url:this.url,method:this.method},e||{});var r=new t(this.method,this.url,this.body,e);return r},i.toObject=function(){var e={};return e.url=this.url,e.method=this.method,e.headers=this.headers.toObject(),e.params=this.params.toObject(),e.body=this.body,e.reportProgress=this.reportProgress,e.responseType=this.responseType,e.withCredentials=this.withCredentials,e.observe=this.observe,e},r=t,(s=[{key:"transferKey",get:function(){var t=e.getLocationComponents(this.url).pathname,r=e.optionsToKey(this.params.toObject()),n=e.optionsToKey(this.body),s=this.method+"-"+t+"-"+r+"-"+n;return s=s.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"}))}}])&&n(r.prototype,s),o&&n(r,o),t}();function j(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function O(e){return"undefined"!=typeof Blob&&e instanceof Blob}function C(e){return"undefined"!=typeof FormData&&e instanceof FormData}var q=function(){function e(){}return e.incrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()+1)},e.decrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()-1)},e.request$=function(n,s,o){var i,a=this;if(void 0===o&&(o={}),n instanceof P)i=n;else{var u=void 0;u=o.headers instanceof p?o.headers:new p(o.headers);var c=void 0;o.params&&(c=new x(o.params,o.paramsEncoder)),i=new P(n,s,void 0!==o.body?o.body:null,{headers:u,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}e.incrementPendingRequest();var h,f=t.of(i).pipe(r.concatMap((function(e){return a.handler.handle(e)})),r.finalize((function(){return e.decrementPendingRequest()})));return n instanceof P||"events"===o.observe?f.pipe(r.catchError((function(e){return console.log("error",e),t.throwError(a.getError(e,null,i))}))):f.pipe(r.filter((function(e){return e instanceof d}))).pipe(r.map((function(e){switch(h=e,o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body;case"blob":if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body;case"text":if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body;case"json":default:return e.body}case"response":return e;default:throw new Error("Unreachable: unhandled observe type "+o.observe+"}")}})),r.catchError((function(e){return console.log("error",e),t.throwError(a.getError(e,h,i))})))},e.delete$=function(e,t){return void 0===t&&(t={}),this.request$("DELETE",e,t)},e.get$=function(e,t){return void 0===t&&(t={}),this.request$("GET",e,t)},e.head$=function(e,t){return void 0===t&&(t={}),this.request$("HEAD",e,t)},e.jsonp$=function(e,t){return this.request$("JSONP",e,{params:(new x).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})},e.options$=function(e,t){return void 0===t&&(t={}),this.request$("OPTIONS",e,t)},e.patch$=function(e,t,r){return void 0===r&&(r={}),this.request$("PATCH",e,$(r,t))},e.post$=function(e,t,r){return void 0===r&&(r={}),this.request$("POST",e,$(r,t))},e.put$=function(e,t,r){return void 0===r&&(r={}),this.request$("PUT",e,$(r,t))},e.getError=function(e,t,r){e.status||(e.statusCode=(null==t?void 0:t.status)||0),e.statusMessage||(e.statusMessage=(null==t?void 0:t.statusText)||"Unknown Error");var n={error:e,status:e.status,statusText:e.statusText,message:e.message,request:r};return t&&(n.headers=t.headers,n.status=n.status||t.status,n.statusText=n.statusText||t.statusText,n.url=t.url),new f(n)},e}();function $(e,t){return Object.assign({},e,{body:t})}q.pendingRequests$=new t.BehaviorSubject(0),q.handler=new g;var S=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).items=[],e.error=null,e}s(n,t);var o=n.prototype;return o.onInit=function(){var t=this;e.getContext(this).node.classList.add("init"),q.get$("/rxcomp-http/data/get-todos.json",{params:{q:{a:1,b:2,c:[1,2,3,4]}},paramsEncoder:new E}).pipe(r.first()).subscribe((function(e){t.items=e.data.getTodos,t.pushChanges()}),(function(e){return console.log})),e.errors$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.error=e,t.pushChanges()}))},o.onClick=function(e){e.completed=!e.completed,this.pushChanges()},n}(e.Component);S.meta={selector:"[app-component]"};var k=function(){function e(){}return e.prototype.intercept=function(e,t){return t.handle(e)},e}(),A=function(){function e(){}return e.prototype.intercept=function(e,t){return t.handle(e).pipe(r.tap((function(t){t instanceof d&&(console.log("CustomResponseInterceptor.status",t.status),console.log("CustomResponseInterceptor.filter",e.params.get("filter")))})))},e}(),B=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t}(e.Module);B.meta={imports:[e.CoreModule,_.useInterceptors([k,A])],declarations:[],bootstrap:S},e.Browser.bootstrap(B)}(rxcomp,rxjs,rxjs.operators);
//# sourceMappingURL=main.min.js.map